---
title: "p8105_hw3_ss6692"
output: github_document
date: "2023-10-11"
---
## Problem 2
```{r libraries, message=FALSE}
library(tidyverse)
library(readxl)
library(dplyr)
library(janitor)
library(tidyr)
library(knitr)
library(viridis)
```
## Problem 2
### Loading the dataset
```{r load_brfss_smart2010}
library(p8105.datasets)
data("brfss_smart2010")
```
### Here, we are cleaning the data and filtering for "Overall Health." We will then order the responses from Poor to Excellent.
```{r clean_and_order_brfss_df}
brfss_df = brfss_smart2010 |>
  janitor::clean_names()|>
  select(-locationabbr)|>
  separate(locationdesc, into = c("state", "county"), sep = " - ")|>
    filter(topic == "Overall Health" & response %in% c("Excellent", "Very good", "Good", "Fair", "Poor")) |>
    mutate(response = factor(response, levels = c("Poor", "Fair", "Good", "Very good", "Excellent"), ordered = TRUE))
```
## Now, we will find which states which states were observed at 7 or more locations in 2002.
```{r states_2002}
brfss_2002_df = 
   brfss_df|>
    filter(year == 2002) |>
    group_by(state) |>
    summarize(count = n()) |>
    filter(count >= 7)
kable(brfss_2002_df)
```
## Now we are finding the same information for 2010.
```{r states_2010}
brfss_2010_df = 
   brfss_df|>
    filter(year == 2010) |>
    group_by(state) |>
    summarize(count = n()) |>
    filter(count >= 7)
kable(brfss_2010_df)
```
In 2002, the following states ` r kable(brfss_2002_df)` were observed at 7 or more locations.

### Now, we are creating a dataset containing only "Excellent" responses. We will also add a new variable that averages `data_value` across locations, but within states.

```{r excellent_df}
excellent_df =
  brfss_df |>
  filter(response == "Excellent")|>
group_by(state, year) |>
  summarize(avg_data_value = mean(data_value, na.rm = TRUE))
```
### We will use the excellent_df to create a spaghetti plot
```{r}
excellent_df |> 
  ggplot(aes(x = year, y = avg_data_value, color = state)) + 
  geom_line() +
  labs(title = "Mean data values of Excellent responses by state ", 
        x = "Year",
        y = "Mean Data Value")
```

```{r}
nyc_df =
  brfss_df |>
  filter((year == 2006 | year == 2010) & state == "NY") |>
  select(year, response, data_value, county)
  
nyc_df |>
  ggplot(aes(x=response, y=data_value)) +
  geom_point() +
  facet_grid(. ~ year) + 
  labs(title = "NY state health responses in 2006 and 2010", 
        x = "Response",
        y = "Data Value") 

```






